/*! Bellhop 1.0.4 */
!function(){"use strict";!function(){"use strict";Function.prototype.bind||(Function.prototype.bind=function(a){var b,c,d=this;if("function"!=typeof d)throw new TypeError;return b=Array.prototype.slice.call(arguments,1),c=function(){if(this instanceof c){var e,f,g;return e=function(){},e.prototype=d.prototype,f=new e,g=d.apply(f,b.concat(Array.prototype.slice.call(arguments))),Object(g)===g?g:f}return d.apply(a,b.concat(Array.prototype.slice.call(arguments)))}})}(),function(a,b){"use strict";var c=function(a){this.handshakeId=a||"Bellhop",this.onReceive=null,this.target=null,this.connected=!1,this.name="",this.isChild=!0,this.connecting=!1,this.origin="*",this._listeners={},this._sendLater=[],this.supported=null},d=c.prototype={};c.CONNECTED="connected",c.FAILED="failed",d.receive=function(a){var b,d,e=a.data;if(e==this.handshakeId){if(this.connecting=!1,this.connected=!0,this.trigger(c.CONNECTED),this.isChild||this.target.postMessage(e,this.origin),d=this._sendLater.length,d>0){for(b=0;d>b;b++){var f=this._sendLater[b];this.send(f.type,f.data)}this._sendLater.length=0}}else{if(!this.connected)return;if(e=JSON.parse(e),"object"!=typeof e)throw"The event received must be an object";if(!e.type)throw"The event received must contain a type";this.trigger(e)}},d.trigger=function(a){"string"==typeof a&&(a={type:a});var c=this._listeners[a.type];if(c!==b)for(var d=0,e=c.length;e>d;d++)c[d](a)},d.toString=function(){return"[Bellhop '"+this.name+"']"},d.connect=function(c,d){if(this.connecting)return this;this.connecting=!0;var e=this.isChild=c===b,f=this.target=e?a.top:c.contentWindow||c;if(this.supported=e?!!f&&a!=f:!!f,this.origin=d===b?"*":d,this.onReceive=this.receive.bind(this),a.attachEvent?a.attachEvent("onmessage",this.onReceive):a.addEventListener("message",this.onReceive),e)if(window===f)this.connecting=!1,this.connected=!1;else{var g=this;a.onload=function(){f.postMessage(g.handshakeId,g.origin)}}return this},d.disconnect=function(){return this.connected=!1,this.connecting=!1,this.origin=null,this.target=null,this._listeners={},this._sendLater.length=0,this.isChild=!0,a.detachEvent?a.detachEvent("onmessage",this.onReceive):a.removeEventListener("message",this.onReceive),this.onReceive=null,this},d.on=function(a,c){if("string"!=typeof a)for(var d in a)this.on(d,a[d]);else for(var e=a.split(" "),f=0,g=e.length;g>f;f++)a=e[f],this._listeners[a]===b&&(this._listeners[a]=[]),this._listeners[a].push(c);return this},d.off=function(a,c){if(this._listeners[a]===b)return this;if(c===b)delete this._listeners[a];else for(var d=this._listeners[a],e=0,f=d.length;f>e;e++)if(d[e]===c){d.splice(e,1);break}return this},d.send=function(a,c){if("string"!=typeof a)throw"The event type must be a string";if(a={type:a},c!==b&&(a.data=c),this.connecting)this._sendLater.push(a);else{if(!this.connected)return this;this.target.postMessage(JSON.stringify(a),this.origin)}return this},d.fetch=function(a,c,d,e){var f=this;if(!this.connecting&&!this.connected)throw"No connection, please call connect() first";e=e===b?!1:e;var g=function(a){e&&f.off(a.type,g),c(a)};return this.on(a,g),this.send(a,d),this},d.respond=function(a,c,d){d=d===b?!1:d;var e=this,f=function(b){d&&e.off(b.type,f),e.send(a,c)};return this.on(a,f),this},d.destroy=function(){this.disconnect(),this._listeners=null,this._sendLater=null},a.Bellhop=c}(window);}();