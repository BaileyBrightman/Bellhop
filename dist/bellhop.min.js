!function(){"use strict";Function.prototype.bind||(Function.prototype.bind=function(t){var e,i,n=this;if("function"!=typeof n)throw new TypeError;return e=Array.prototype.slice.call(arguments,1),i=function(){if(this instanceof i){var s,r,o;return s=function(){},s.prototype=n.prototype,r=new s,o=n.apply(r,e.concat(Array.prototype.slice.call(arguments))),Object(o)===o?o:r}return n.apply(t,e.concat(Array.prototype.slice.call(arguments)))}})}(),function(t,e){"use strict";var i=function(t){this.handshakeId=t||"Bellhop",this.onReceive=null,this.target=null,this.connected=!1,this.name="",this.isChild=!0,this.connecting=!1,this.origin="*",this._listeners={},this._sendLater=[]},n=i.prototype={};i.VERSION="1.0.1",i.CONNECTED="connected",i.FAILED="failed",n.receive=function(t){var e,n,s=t.data;if(s==this.handshakeId){if(this.connecting=!1,this.connected=!0,this.trigger(i.CONNECTED),this.isChild||this.target.postMessage(s,this.origin),n=this._sendLater.length,n>0){for(e=0;n>e;e++){var r=this._sendLater[e];this.send(r.type,r.data)}this._sendLater.length=0}}else{if(!this.connected)return;if(s=JSON.parse(s),"object"!=typeof s)throw"The event received must be an object";if(!s.type)throw"The event received must contain a type";this.trigger(s)}},n.trigger=function(t){"string"==typeof t&&(t={type:t});var i=this._listeners[t.type];if(i!==e)for(var n=0,s=i.length;s>n;n++)i[n](t)},n.toString=function(){return"[Bellhop '"+this.name+"']"},n.connect=function(i,n){if(this.connecting)return this;this.connecting=!0;var s=this.isChild=i===e;return this.target=s?t.top:i.contentWindow||i,this.origin=n===e?"*":n,this.onReceive=this.receive.bind(this),t.addEventListener("message",this.onReceive),s&&(window!=this.target?this.target.postMessage(this.handshakeId,this.origin):(this.connecting=!1,this.connected=!1)),this},Object.defineProperty(n,"supported",{get:function(){var t=this.target;return this.isChild?!!t&&window!=t:!!t}}),n.disconnect=function(){return this.connected=!1,this.connecting=!1,this.origin=null,this.target=null,this._listeners={},this._sendLater.length=0,this.isChild=!0,t.removeEventListener("message",this.onReceive),this.onReceive=null,this},n.on=function(t,i){if("string"!=typeof t)for(var n in t)this.on(n,t[n]);else for(var s=t.split(" "),r=0,o=s.length;o>r;r++)t=s[r],this._listeners[t]===e&&(this._listeners[t]=[]),this._listeners[t].push(i);return this},n.off=function(t,i){if(this._listeners[t]===e)return this;if(i===e)delete this._listeners[t];else for(var n=this._listeners[t],s=0,r=n.length;r>s;s++)if(n[s]===i){n.splice(s,1);break}return this},n.send=function(t,i){if("string"!=typeof t)throw"The event type must be a string";if(t={type:t},i!==e&&(t.data=i),this.connecting)this._sendLater.push(t);else{if(!this.connected)return this;this.target.postMessage(JSON.stringify(t),this.origin)}return this},n.fetch=function(t,i,n,s){s=s===e?!1:s;var r=this,o=function(t){s&&r.off(t.type,o),i(t)};return this.on(t,o),this.send(t,n),this},n.respond=function(t,i,n){n=n===e?!1:n;var s=this,r=function(e){n&&s.off(e.type,r),s.send(t,i)};return this.on(t,r),this},n.destroy=function(){this.disconnect(),this._listeners=null,this._sendLater=null},t.Bellhop=i}(window);